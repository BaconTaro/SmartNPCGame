## AI生成的两周内计划，后续实际coding再修改
### **🛠️ 成员E - GPT对话系统两周开发计划**
**核心目标：实现NPC个性化对话生成与API对接**

---

#### **🌐 1. GPT接口通讯基础搭建（第1-2天）**
- 创建`UChatGPTHandler`基类 → 定义`SendMessage()`/`OnResponseReceived()`事件
- 设计API请求参数结构：包含`temperature`/`max_tokens`等控制参数
- 实现HTTP模块：使用UE的`VaRest`插件或原生`HTTP Request`节点
- 开发本地模拟模式：用DataTable存储测试对话响应样例

**技术依赖**：需成员C提供对话框基础UI框架后才可联调

---

#### **🎭 2. NPC角色人设模板设计（第3天）**
- 创建`NPC_Persona`数据结构 → 包含身份/性格/知识领域字段
- 制作预设模板（如科学家/工程师）→ 存储于`DataTable`
- 开发动态标签系统：根据NPC当前位置自动附加"房间A/设备X"等场景标签
- 绑定到`UChatGPTHandler`的初始化流程

---

#### **📝 3. 上下文Prompt生成系统（第4-5天）**
- 创建`BP_ContextBuilder`组件 → 收集以下要素：
  - 当前摄像头视角的房间特征（从成员B的CameraManager获取）
  - 玩家已获得的物品列表（与成员D的交互系统对接）
  - NPC最近3条对话历史（使用GameInstance持久化）
- 实现多级权重机制：核心人设(60%)+环境要素(30%)+近期对话(10%)
- 输出格式化字符串：`"你是一个{role}，正在{location}，已知玩家有{items}，请用{style}风格回答："`

---

#### **🔌 4. API安全与流式响应处理（第6-7天）**
- 配置请求超时机制：设置15秒自动取消+重试按钮
- 实现分块响应解析：通过`JSON Field`识别`"delta_content"`
- 开发打字机效果：用`TimerByEvent`逐字显示到对话框
- 添加敏感词过滤层：使用`Regex`匹配非法内容替换为[***]

---

#### **💡 5. 提示词优化与调试系统（第8-9天）**
- 创建调试面板`WBP_DebugConsole`：可实时编辑prompt权重参数
- 实现对话日志记录：自动保存为CSV文件（含时间戳/原始prompt/响应）
- 制作典型测试用例：包含物品查询/谜题提示/情感反应等场景
- 与成员D联调NPC动作反馈：如思考时播放摸下巴动画

---

#### **🚀 6. 最终集成与性能优化（第10天）**
- 接入成员C的`WBP_ChatUI` → 绑定发送/接收事件链
- 压力测试：模拟10分钟内连续50次请求的稳定性
- 添加本地缓存机制：当API无响应时使用上次成功响应
- 制作应急方案：配置备用API终端URL（OpenRouter/Azure双通道）

---

### **🔗 关键协作节点**
1. **与成员C**：第5天对接对话框进度条动画接口
2. **与成员D**：第3天确定NPC人设数据导入方式
3. **与成员B**：第4天获取房间特征命名规范

---

### **⚠️ 风险预案**
- **API延迟过高**：启用"正在思考..."动画+禁用重复发送
- **内容不可控**：预置20条标准回复作为fallback方案
- **多语言支持**：预留`LocalizationTable`接口但不实现

---

### **📊 验收标准**
✅ 角色人设影响度测试：同一问题不同NPC回答差异明显  
✅ 平均响应时间＜4秒（含网络延迟）  
✅ 上下文包含至少3个环境要素时提示词不超2048tokens  
✅ 错误率＜5%（10小时压力测试）

---